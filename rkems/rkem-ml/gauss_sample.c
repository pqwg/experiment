#ifdef __KERNEL__
#include <linux/string.h>
#else
#include <string.h>
#endif

#include "params.h"
#include "poly.h"
#include "randombytes.h"
#include "gauss_sample.h"

#include "symmetric.h"

static uint32_t r_gauss_table[] = { // std 0.55
    2712284u, 16134680u, 4163004u,
    18918u, 4188519u, 3622089u,
    4u, 14602513u, 16124988u,
    0u, 771u, 9813948u,
    0u, 0u, 4483u,
};

static uint32_t sk_gauss_table[] = { // std 2.6
    12313548u, 5992809u, 14866927u,
    8168119u, 6614162u, 9948518u,
    4847628u, 51456u, 15693191u,
    2553643u, 7122694u, 5563496u,
    1186752u, 7146685u, 8413494u,
    484274u, 12585930u, 3016175u,
    172897u, 13848393u, 13865717u,
    53857u, 1620950u, 7559445u,
    14605u, 4360786u, 7961363u,
    3442u, 4913250u, 6560378u,
    704u, 2679901u, 10300634u,
    124u, 14844706u, 7879310u,
    19u, 3120409u, 2340495u,
    2u, 9251790u, 11731707u,
    0u, 4924767u, 8872434u,
    0u, 489928u, 12169416u,
    0u, 42128u, 8899962u,
    0u, 3130u, 3420874u,
    0u, 200u, 15270397u,
    0u, 11u, 2296489u,
    0u, 0u, 8943192u,
    0u, 0u, 369554u,
    0u, 0u, 13182u,
    0u, 0u, 406u,
    0u, 0u, 11u,
};

static uint32_t noise_gauss_table[] = { // std 2^6
    16569351u, 1176889u, 2468275u,
    16361511u, 8604772u, 9596689u,
    16153748u, 919472u, 14472468u,
    15946111u, 6153639u, 2579139u,
    15738652u, 451504u, 5698515u,
    15531420u, 8112133u, 4799489u,
    15324467u, 308733u, 1648272u,
    15117841u, 11915175u, 16335876u,
    14911594u, 6678431u, 6035518u,
    14705774u, 10831341u, 1091297u,
    14500431u, 11829986u, 10963721u,
    14295614u, 8092336u, 15059782u,
    14091371u, 8412292u, 5159952u,
    13887750u, 14604255u, 13479321u,
    13684800u, 4156129u, 8257729u,
    13482566u, 13554703u, 4513816u,
    13281097u, 3516985u, 10463315u,
    13080437u, 9444594u, 10455966u,
    12880633u, 6676485u, 10125923u,
    12681729u, 10634313u, 11161042u,
    12483770u, 9207829u, 11441263u,
    12286799u, 12593544u, 3776375u,
    12090860u, 2483392u, 10688429u,
    11895993u, 15484944u, 8184248u,
    11702242u, 8452117u, 14671231u,
    11509646u, 9043351u, 8727254u,
    11318245u, 14636771u, 7430610u,
    11128079u, 8701528u, 2549895u,
    10939185u, 10739622u, 15762613u,
    10751601u, 8803651u, 15400564u,
    10565363u, 9471838u, 1171580u,
    10380507u, 3954078u, 12978035u,
    10197067u, 1324245u, 1758169u,
    10015076u, 11438485u, 12492365u,
    9834568u, 11094204u, 10142012u,
    9655574u, 10870433u, 6123003u,
    9478125u, 4545972u, 1170654u,
    9302250u, 2422042u, 13137864u,
    9127977u, 14331853u, 2527940u,
    8955335u, 15891598u, 9581126u,
    8784350u, 15433483u, 10499121u,
    8615048u, 3516995u, 8369685u,
    8447452u, 3122250u, 6445924u,
    8281586u, 2421590u, 6519353u,
    8117472u, 5010413u, 4016485u,
    7955131u, 13047790u, 4176552u,
    7794584u, 10415641u, 8728807u,
    7635849u, 13005211u, 5889386u,
    7478945u, 1581321u, 4129354u,
    7323887u, 5659684u, 15662994u,
    7170692u, 2852769u, 5561730u,
    7019374u, 2782733u, 9730234u,
    6869946u, 13571315u, 1152690u,
    6722422u, 8346908u, 15042711u,
    6576812u, 9209065u, 7188347u,
    6433127u, 3437425u, 10074654u,
    6291375u, 10711869u, 6739613u,
    6151565u, 16130857u, 9226838u,
    6013705u, 3908623u, 13753370u,
    5877799u, 7864753u, 13177912u,
    5743853u, 10933588u, 15815912u,
    5611871u, 12460143u, 4745731u,
    5481856u, 11623860u, 7342658u,
    5353810u, 7653061u, 8382944u,
    5227734u, 52408u, 9626596u,
    5103627u, 5620129u, 574510u,
    4981489u, 8368438u, 6072847u,
    4861318u, 10118829u, 5441367u,
    4743111u, 13999566u, 2296555u,
    4626865u, 7953738u, 1990737u,
    4512574u, 15366220u, 3642756u,
    4400234u, 11482425u, 10657803u,
    4289838u, 7608210u, 10667768u,
    4181379u, 1100511u, 7079932u,
    4074848u, 9251985u, 13220388u,
    3970238u, 2519745u, 16650619u,
    3867538u, 5533100u, 201978u,
    3766738u, 13558225u, 16381158u,
    3667828u, 9631913u, 2451037u,
    3570795u, 15254968u, 4338725u,
    3475628u, 6872592u, 6923466u,
    3382313u, 131084u, 14570229u,
    3290835u, 16697674u, 3139197u,
    3201183u, 751817u, 16690742u,
    3113339u, 3914558u, 5177576u,
    3027289u, 1081213u, 13028095u,
    2943016u, 8245545u, 5685092u,
    2860504u, 15775635u, 11335662u,
    2779737u, 5576451u, 5824790u,
    2700696u, 1806961u, 12079048u,
    2623363u, 4156402u, 9674276u,
    2547720u, 5005818u, 11697854u,
    2473748u, 6588358u, 10784559u,
    2401428u, 4593454u, 7283499u,
    2330740u, 5323326u, 12893700u,
    2261664u, 9292540u, 13735985u,
    2194180u, 11601862u, 8040641u,
    2128268u, 2308814u, 2198650u,
    2063906u, 348990u, 9250317u,
    2001073u, 3567265u, 7861701u,
    1939748u, 5853489u, 6988514u,
    1879909u, 14273485u, 15874245u,
    1821535u, 15863383u, 14614944u,
    1764604u, 11527498u, 387379u,
    1709093u, 16376177u, 15800231u,
    1654981u, 9726138u, 16580935u,
    1602245u, 2535181u, 8735116u,
    1550862u, 4167250u, 16288658u,
    1500810u, 5928126u, 14911607u,
    1452066u, 14925964u, 3914894u,
    1404609u, 4038765u, 6257029u,
    1358414u, 12869628u, 6233465u,
    1313460u, 13813640u, 2674528u,
    1269724u, 12998314u, 1541365u,
    1227184u, 221470u, 2650558u,
    1185815u, 16321894u, 11603552u,
    1145598u, 2438354u, 14000977u,
    1106508u, 1582221u, 3073749u,
    1068523u, 7880549u, 16732102u,
    1031622u, 360474u, 591998u,
    995781u, 10279908u, 8324259u,
    960980u, 3900727u, 11141295u,
    927196u, 134788u, 11062665u,
    894407u, 3632391u, 3027866u,
    862592u, 4971414u, 4337991u,
    831729u, 14392710u, 13954942u,
    801798u, 11641272u, 6051200u,
    772777u, 13239790u, 12505645u,
    744646u, 5536423u, 7613758u,
    717383u, 11962274u, 375432u,
    690969u, 9285981u, 15737311u,
    665383u, 11632601u, 5793244u,
    640606u, 3499749u, 688326u,
    616617u, 6983786u, 13675815u,
    593397u, 14780683u, 6185045u,
    570928u, 7065472u, 13141070u,
    549190u, 1918777u, 13976037u,
    528164u, 5082793u, 5279938u,
    507832u, 10041803u, 519172u,
    488176u, 14872934u, 1529285u,
    469179u, 5535641u, 13425223u,
    450822u, 6263367u, 9884489u,
    433088u, 12508145u, 3492255u,
    415961u, 7764902u, 12661940u,
    399423u, 13943972u, 943074u,
    383459u, 7519808u, 7874711u,
    368052u, 3445975u, 5185963u,
    353186u, 4846673u, 14792590u,
    338846u, 3034366u, 8060039u,
    325016u, 11076449u, 11988238u,
    311682u, 13470641u, 3263694u,
    298829u, 16478631u, 15009233u,
    286443u, 14568805u, 7933090u,
    274510u, 7185930u, 7603146u,
    263015u, 15516355u, 8054497u,
    251946u, 15362805u, 14268916u,
    241290u, 4232767u, 3766108u,
    231033u, 1314041u, 13839844u,
    221162u, 13892085u, 9564474u,
    211667u, 3763733u, 7598343u,
    202534u, 4642431u, 1658881u,
    193752u, 4679176u, 13649049u,
    185309u, 13529744u, 9749350u,
    177195u, 11978468u, 6917726u,
    169399u, 2222562u, 2891977u,
    161909u, 7822194u, 9415319u,
    154716u, 6539264u, 4734625u,
    147809u, 14168841u, 10588322u,
    141180u, 596327u, 13053337u,
    134817u, 7179235u, 15334874u,
    128712u, 12468911u, 3347587u,
    122856u, 16034383u, 1655029u,
    117241u, 4844172u, 3695731u,
    111857u, 3532782u, 3803621u,
    106696u, 7225419u, 12118615u,
    101750u, 15024881u, 5216296u,
    97012u, 13165791u, 3677591u,
    92474u, 8499609u, 622491u,
    88128u, 11647231u, 3884835u,
    83968u, 3373734u, 2676748u,
    79986u, 1625882u, 5818733u,
    76175u, 11128701u, 13755340u,
    72530u, 6536166u, 4851767u,
    69043u, 16244959u, 16588991u,
    65710u, 4881524u, 16602180u,
    62523u, 7447316u, 13890060u,
    59477u, 11805876u, 5616680u,
    56567u, 8942201u, 10406531u,
    53787u, 9667908u, 4537471u,
    51132u, 10995037u, 15998652u,
    48597u, 12841883u, 13717848u,
    46178u, 1184821u, 4937132u,
    43868u, 15096721u, 3575625u,
    41665u, 12459334u, 8004323u,
    39564u, 4111753u, 16103674u,
    37560u, 3450175u, 12826005u,
    35649u, 9582818u, 8907092u,
    33828u, 7262832u, 1717430u,
    32093u, 376455u, 9425403u,
    30439u, 11877601u, 7188102u,
    28864u, 16614471u, 11208637u,
    27365u, 8374832u, 1961117u,
    25937u, 16600600u, 15977778u,
    24579u, 5662915u, 16206473u,
    23286u, 9019242u, 10115724u,
    22056u, 11713282u, 577637u,
    20887u, 648099u, 15444087u,
    19774u, 14860334u, 81101u,
    18717u, 11246120u, 4315778u,
    17712u, 15500798u, 15932371u,
    16758u, 4624283u, 13559829u,
    15851u, 7531367u, 3996213u,
    14990u, 4336568u, 9384533u,
    14172u, 10189498u, 3774149u,
    13396u, 8116421u, 2003263u,
    12659u, 16080692u, 4090161u,
    11961u, 3049392u, 6681714u,
    11298u, 6387697u, 14394778u,
    10669u, 14373364u, 8596062u,
    10073u, 16484505u, 8279577u,
    9509u, 3356847u, 16103048u,
    8974u, 296541u, 7044774u,
    8467u, 130780u, 13105973u,
    7986u, 13500042u, 3083959u,
    7532u, 1710896u, 10601321u,
    7101u, 10916493u, 7690597u,
    6694u, 4308220u, 12702127u,
    6308u, 13075521u, 1330755u,
    5944u, 2154071u, 15542782u,
    5599u, 4410443u, 14540303u,
    5273u, 3169524u, 7805156u,
    4964u, 16069523u, 10700187u,
    4673u, 11145791u, 8690789u,
    4398u, 7464967u, 7805924u,
    4138u, 7987906u, 7205521u,
    3892u, 16319604u, 8934755u,
    3661u, 3128377u, 7010434u,
    3442u, 6783648u, 11061521u,
    3235u, 15890793u, 5150711u,
    3041u, 2821769u, 7967099u,
    2857u, 7578222u, 12524297u,
    2684u, 3551588u, 1406993u,
    2520u, 14942217u, 14607067u,
    2366u, 16075468u, 11801515u,
    2221u, 15267911u, 9371301u,
    2085u, 4476542u, 156094u,
    1956u, 9611995u, 4068521u,
    1835u, 6634722u, 12219532u,
    1721u, 5423999u, 8800193u,
    1613u, 16207071u, 5873791u,
    1512u, 15988934u, 12397013u,
    1417u, 15646027u, 13073664u,
    1328u, 9580005u, 2700886u,
    1244u, 9258171u, 8133598u,
    1165u, 9645611u, 615232u,
    1091u, 5969508u, 8299415u,
    1021u, 10483995u, 5236589u,
    956u, 2126640u, 13585807u,
    894u, 10393163u, 5202222u,
    836u, 14663240u, 16022417u,
    782u, 11298942u, 2805519u,
    731u, 13634736u, 648156u,
    684u, 1636283u, 4394452u,
    639u, 5777368u, 9336137u,
    597u, 6367855u, 14775569u,
    558u, 654188u, 1118869u,
    521u, 2811392u, 14416207u,
    486u, 10381013u, 11564236u,
    454u, 4263815u, 14430527u,
    423u, 15821687u, 2941941u,
    395u, 9430480u, 6436463u,
    368u, 16691401u, 2768772u,
    344u, 2207233u, 12212013u,
    320u, 14571520u, 7208904u,
    299u, 1813692u, 2939271u,
    278u, 12720426u, 11467710u,
    259u, 12281288u, 821114u,
    241u, 15901709u, 5879188u,
    225u, 5512396u, 6549537u,
    209u, 13451110u, 16162465u,
    195u, 5018072u, 6232560u,
    181u, 12689800u, 3583737u,
    169u, 1897693u, 13082231u,
    157u, 5242251u, 11441699u,
    146u, 5049227u, 10823928u,
    136u, 475330u, 11224540u,
    126u, 7505222u, 888104u,
    117u, 8617018u, 829125u,
    109u, 3111235u, 3036586u,
    101u, 7108227u, 8648124u,
    94u, 3214109u, 7557828u,
    87u, 7627317u, 13522949u,
    81u, 3027567u, 4454014u,
    75u, 5682649u, 7392218u,
    69u, 15114830u, 1084948u,
    64u, 14098999u, 657752u,
    60u, 2215352u, 4626670u,
    55u, 12624952u, 8090708u,
    51u, 11404868u, 4125286u,
    47u, 14987206u, 16124530u,
    44u, 6271637u, 5694194u,
    41u, 1732933u, 7089418u,
    38u, 1088080u, 3303643u,
    35u, 4072313u, 1310589u,
    32u, 10438007u, 11758360u,
    30u, 3176416u, 10187471u,
    27u, 15625545u, 9754391u,
    25u, 14028710u, 8827578u,
    23u, 14974171u, 15422854u,
    22u, 1508228u, 425861u,
    20u, 7020516u, 2862822u,
    18u, 14579983u, 8630196u,
    17u, 7265844u, 14668815u,
    16u, 1721365u, 4666835u,
    14u, 14598817u, 469161u,
    13u, 12227257u, 2858399u,
    12u, 11275283u, 6205567u,
    11u, 11641662u, 4715467u,
    10u, 13232068u, 10246913u,
    9u, 15958637u, 2548829u,
    9u, 2962326u, 2647024u,
    8u, 7721386u, 8526364u,
    7u, 13387695u, 3348419u,
    7u, 3118055u, 12837486u,
    6u, 10405520u, 5135127u,
    6u, 1638571u, 14787199u,
    5u, 10318566u, 1220073u,
    5u, 2841734u, 10084057u,
    4u, 12716661u, 15666841u,
    4u, 6346321u, 14721847u,
    4u, 468369u, 3446151u,
    3u, 11823285u, 7083583u,
    3u, 6822537u, 13689327u,
    3u, 2211694u, 16701136u,
    2u, 14738610u, 2612066u,
    2u, 10821615u, 5963461u,
    2u, 7212670u, 2231015u,
    2u, 3888359u, 13797837u,
    2u, 826982u, 16288060u,
    1u, 14785647u, 4863849u,
    1u, 12191293u, 10210892u,
    1u, 9803887u, 5451356u,
    1u, 7607456u, 14813738u,
    1u, 5587218u, 13934428u,
    1u, 3729493u, 635758u,
    1u, 2021623u, 11462684u,
    1u, 451905u, 10649768u,
    0u, 15786731u, 14770797u,
    0u, 14461665u, 11369646u,
    0u, 13244677u, 1956010u,
    0u, 12127223u, 13525011u,
    0u, 11101415u, 6942727u,
    0u, 10159965u, 13473131u,
    0u, 9296148u, 8902715u,
    0u, 8503755u, 8046846u,
    0u, 7777058u, 7018859u,
    0u, 7110773u, 4843997u,
    0u, 6500027u, 664522u,
    0u, 5940326u, 13973510u,
    0u, 5427531u, 7727437u,
    0u, 4957824u, 13791850u,
    0u, 4527691u, 5363115u,
    0u, 4133893u, 686991u,
    0u, 3773448u, 10123890u,
    0u, 3443613u, 9171684u,
    0u, 3141862u, 2743740u,
    0u, 2865870u, 11238378u,
    0u, 2613501u, 10374737u,
    0u, 2382789u, 7870155u,
    0u, 2171927u, 3925254u,
    0u, 1979254u, 2005765u,
    0u, 1803244u, 1615756u,
    0u, 1642495u, 5501385u,
    0u, 1495720u, 6691427u,
    0u, 1361737u, 4738008u,
    0u, 1239460u, 16701487u,
    0u, 1127895u, 14931173u,
    0u, 1026128u, 8964520u,
    0u, 933321u, 2382479u,
    0u, 848705u, 8494425u,
    0u, 771577u, 6783596u,
    0u, 701291u, 7301018u,
    0u, 637256u, 4361259u,
    0u, 578930u, 3585159u,
    0u, 525817u, 4380797u,
    0u, 477463u, 4536873u,
    0u, 433452u, 9747935u,
    0u, 393404u, 14142785u,
    0u, 356972u, 1800650u,
    0u, 323836u, 2487764u,
    0u, 293705u, 16766754u,
    0u, 266315u, 11529069u,
    0u, 241422u, 2471697u,
    0u, 218803u, 5177357u,
    0u, 198256u, 5573662u,
    0u, 179595u, 16677107u,
    0u, 162653u, 3330186u,
    0u, 147273u, 10302262u,
    0u, 133316u, 7054278u,
    0u, 120653u, 2666992u,
    0u, 109166u, 11365144u,
    0u, 98750u, 2728587u,
    0u, 89306u, 4245520u,
    0u, 80746u, 3778271u,
    0u, 72989u, 4163489u,
    0u, 65961u, 11750965u,
    0u, 59596u, 9127900u,
    0u, 53832u, 12613717u,
    0u, 48614u, 13126740u,
    0u, 43892u, 1682887u,
    0u, 39618u, 12356339u,
    0u, 35752u, 14873672u,
    0u, 32256u, 9111086u,
    0u, 29095u, 2679918u,
    0u, 26237u, 5774190u,
    0u, 23654u, 9685390u,
    0u, 21320u, 16056171u,
    0u, 19212u, 16175515u,
    0u, 17309u, 4170065u,
    0u, 15590u, 7285564u,
    0u, 14038u, 15791395u,
    0u, 12638u, 13810512u,
    0u, 11375u, 10389131u,
    0u, 10236u, 3676847u,
    0u, 9208u, 12416100u,
    0u, 8282u, 6951613u,
    0u, 7447u, 8179455u,
    0u, 6695u, 2099708u,
    0u, 6017u, 5503807u,
    0u, 5406u, 14348922u,
    0u, 4857u, 2580437u,
    0u, 4362u, 4946758u,
    0u, 3916u, 15361670u,
    0u, 3516u, 2795609u,
    0u, 3155u, 11133609u,
    0u, 2831u, 7448469u,
    0u, 2539u, 15553540u,
    0u, 2277u, 14735464u,
    0u, 2042u, 6314612u,
    0u, 1830u, 13147228u,
    0u, 1640u, 12064723u,
    0u, 1470u, 572595u,
    0u, 1316u, 13255780u,
    0u, 1179u, 4000941u,
    0u, 1055u, 13462923u,
    0u, 945u, 1015527u,
    0u, 845u, 12272620u,
    0u, 756u, 11088565u,
    0u, 676u, 13570006u,
    0u, 605u, 4003339u,
    0u, 541u, 1794810u,
    0u, 483u, 10986164u,
    0u, 432u, 3339287u,
    0u, 386u, 2097349u,
    0u, 344u, 14762984u,
    0u, 307u, 16218968u,
    0u, 274u, 15744818u,
    0u, 245u, 6601788u,
    0u, 218u, 16289232u,
    0u, 195u, 5813331u,
    0u, 174u, 3843461u,
    0u, 155u, 5993516u,
    0u, 138u, 8326380u,
    0u, 123u, 7308866u,
    0u, 109u, 16548294u,
    0u, 97u, 16424212u,
    0u, 87u, 4387026u,
    0u, 77u, 11705475u,
    0u, 69u, 2776534u,
    0u, 61u, 9319020u,
    0u, 54u, 12911347u,
    0u, 48u, 12080846u,
    0u, 43u, 5508950u,
    0u, 38u, 8792589u,
    0u, 34u, 4098303u,
    0u, 30u, 7258312u,
    0u, 27u, 650149u,
    0u, 24u, 295189u,
    0u, 21u, 5517710u,
    0u, 18u, 15713774u,
    0u, 16u, 13566521u,
    0u, 14u, 15371094u,
    0u, 13u, 3919739u,
    0u, 11u, 12382480u,
    0u, 10u, 6861746u,
    0u, 9u, 3828531u,
    0u, 8u, 3009628u,
    0u, 7u, 4161348u,
    0u, 6u, 7066385u,
    0u, 5u, 11531006u,
    0u, 5u, 605327u,
    0u, 4u, 7689922u,
    0u, 3u, 15870513u,
    0u, 3u, 8247814u,
    0u, 3u, 1490354u,
    0u, 2u, 12278599u,
    0u, 2u, 6972017u,
    0u, 2u, 2271220u,
    0u, 1u, 14885286u,
    0u, 1u, 11199190u,
    0u, 1u, 7936279u,
    0u, 1u, 5048674u,
    0u, 1u, 2493831u,
    0u, 1u, 233954u,
    0u, 0u, 15012693u,
    0u, 0u, 13245811u,
    0u, 0u, 11684067u,
    0u, 0u, 10303980u,
    0u, 0u, 9084719u,
    0u, 0u, 8007806u,
    0u, 0u, 7056853u,
    0u, 0u, 6217332u,
    0u, 0u, 5476367u,
    0u, 0u, 4822548u,
    0u, 0u, 4245765u,
    0u, 0u, 3737067u,
    0u, 0u, 3288526u,
    0u, 0u, 2893125u,
    0u, 0u, 2544653u,
    0u, 0u, 2237615u,
    0u, 0u, 1967150u,
    0u, 0u, 1728961u,
    0u, 0u, 1519247u,
    0u, 0u, 1334648u,
    0u, 0u, 1172198u,
    0u, 0u, 1029272u,
    0u, 0u, 903556u,
    0u, 0u, 793004u,
    0u, 0u, 695810u,
    0u, 0u, 610382u,
    0u, 0u, 535314u,
    0u, 0u, 469364u,
    0u, 0u, 411441u,
    0u, 0u, 360579u,
    0u, 0u, 315928u,
    0u, 0u, 276739u,
    0u, 0u, 242354u,
    0u, 0u, 212189u,
    0u, 0u, 185735u,
    0u, 0u, 162539u,
    0u, 0u, 142206u,
    0u, 0u, 124387u,
    0u, 0u, 108774u,
    0u, 0u, 95098u,
    0u, 0u, 83121u,
    0u, 0u, 72635u,
    0u, 0u, 63457u,
    0u, 0u, 55425u,
    0u, 0u, 48398u,
    0u, 0u, 42252u,
    0u, 0u, 36878u,
    0u, 0u, 32179u,
    0u, 0u, 28072u,
    0u, 0u, 24484u,
    0u, 0u, 21349u,
    0u, 0u, 18610u,
    0u, 0u, 16220u,
    0u, 0u, 14133u,
    0u, 0u, 12311u,
    0u, 0u, 10722u,
    0u, 0u, 9335u,
    0u, 0u, 8126u,
    0u, 0u, 7072u,
    0u, 0u, 6153u,
    0u, 0u, 5352u,
    0u, 0u, 4655u,
    0u, 0u, 4047u,
    0u, 0u, 3518u,
    0u, 0u, 3057u,
    0u, 0u, 2656u,
    0u, 0u, 2307u,
    0u, 0u, 2003u,
    0u, 0u, 1739u,
    0u, 0u, 1510u,
    0u, 0u, 1310u,
    0u, 0u, 1136u,
    0u, 0u, 986u,
    0u, 0u, 855u,
    0u, 0u, 741u,
    0u, 0u, 642u,
    0u, 0u, 556u,
    0u, 0u, 482u,
    0u, 0u, 417u,
    0u, 0u, 361u,
    0u, 0u, 313u,
    0u, 0u, 271u,
    0u, 0u, 234u,
    0u, 0u, 203u,
    0u, 0u, 175u,
    0u, 0u, 152u,
    0u, 0u, 131u,
    0u, 0u, 113u,
    0u, 0u, 98u,
    0u, 0u, 84u,
    0u, 0u, 73u,
    0u, 0u, 63u,
    0u, 0u, 54u,
    0u, 0u, 47u,
    0u, 0u, 40u,
    0u, 0u, 35u,
    0u, 0u, 30u,
    0u, 0u, 26u,
    0u, 0u, 22u,
    0u, 0u, 19u,
    0u, 0u, 17u,
    0u, 0u, 14u,
    0u, 0u, 12u,
    0u, 0u, 11u,
    0u, 0u, 9u,
    0u, 0u, 8u,
    0u, 0u, 7u,
    0u, 0u, 6u,
    0u, 0u, 5u,
    0u, 0u, 4u,
    0u, 0u, 4u,
    0u, 0u, 3u,
    0u, 0u, 3u,
    0u, 0u, 2u,
    0u, 0u, 2u,
    0u, 0u, 2u,
    0u, 0u, 1u,
    0u, 0u, 1u,
    0u, 0u, 1u,
    0u, 0u, 1u,
    0u, 0u, 1u,
    0u, 0u, 1u,
    0u, 0u, 1u,
};

/**
 * Sample a semi gaussian distribution of standard deviation 2^2.
 * v_i are random values in [0, 1<<63).
 */
static int gauss_sample(const uint32_t *gauss_table, size_t table_len, const uint32_t v0, const uint32_t v1, const uint32_t v2)
{
    size_t u;
    int z;

    /*
     * Sampled value is z, such that v0..v2 is lower than the first
     * z elements of the table.
     */
    z = 0;
    for (u = 0; u < table_len / sizeof(uint32_t); u += 3)
    {
        uint64_t w0, w1, w2, cc;

        w0 = gauss_table[u + 2];
        w1 = gauss_table[u + 1];
        w2 = gauss_table[u + 0];
        cc = (v0 - w0) >> 24;
        cc = (v1 - w1 - cc) >> 24;
        cc = (v2 - w2 - cc) >> 24;
        z += (int)cc;
    }

    return z;
}

static void sample_gauss_poly(const uint32_t *gauss_table, size_t table_len, poly *r, const uint8_t seed[KYBER_SYMBYTES], uint8_t separator, const uint8_t nonce)
{
    size_t i;
    uint8_t prefix[2];
    prefix[0] = separator;
    prefix[1] = nonce;

    //  absorb seed
    shake256incctx st;
    shake256_inc_init(&st);
    shake256_inc_absorb(&st, prefix, sizeof(prefix));
    shake256_inc_absorb(&st, seed, KYBER_SYMBYTES);
    shake256_inc_finalize(&st);

    // sample Gaussian y
    uint8_t buf[10];
    uint32_t v0, v1, v2;
    int s;
    for (i = 0; i < KYBER_N; i++)
    {
        shake256_inc_squeeze(buf, sizeof(buf), &st);
        s = buf[9] & 1; // sample a sign

        v0 = ((uint32_t)buf[0]) | (((uint32_t)buf[1]) << 8) |
             (((uint32_t)buf[2]) << 16);
        v1 = ((uint32_t)buf[3]) | (((uint32_t)buf[4]) << 8) |
             (((uint32_t)buf[5]) << 16);
        v2 = ((uint32_t)buf[6]) | (((uint32_t)buf[7]) << 8) |
             (((uint32_t)buf[8]) << 16);

        r->coeffs[i] = (2 * s - 1) * gauss_sample(gauss_table, table_len, v0, v1, v2);
    }

    shake256_inc_ctx_release(&st);
}

void sample_sk_poly(poly *r, const uint8_t seed[KYBER_SYMBYTES], const uint8_t nonce)
{
    sample_gauss_poly(sk_gauss_table, sizeof(sk_gauss_table), r, seed, 's', nonce);
}

void sample_r_poly(poly *r, const uint8_t seed[KYBER_SYMBYTES], const uint8_t nonce)
{
    sample_gauss_poly(r_gauss_table, sizeof(r_gauss_table), r, seed, 'r', nonce);
}

void sample_noise_poly(poly *r, const uint8_t seed[KYBER_SYMBYTES], const uint8_t nonce)
{
    sample_gauss_poly(noise_gauss_table, sizeof(noise_gauss_table), r, seed, 'n', nonce);
}
